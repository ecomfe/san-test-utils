<!doctype html><html><head><meta charset="utf-8"/><title>san-test-utils</title><link rel="icon" href="https://baidu.github.io/san/img/favicon.ico"><script>window['SAN_DOCIT'] = {};</script><base href="/san-test-utils/"><meta name="description" content="单元测试实用工具库"><link href="/san-test-utils/static/css/chunk-vendors.css" rel="stylesheet"></head><body><div id="app"><div id="site"><header id="header"><a href="/san-test-utils/" class="navbar"><img src="/san-test-utils/logo.svg" alt="Home" class="logo"> <span>san-test-utils</span></a><ul></ul></header><aside id="sidebar" class="sidebar"><ul class="tree"><li><span>介绍</span><ul><li data-id="/"><a href="/san-test-utils/" onclick="return false;">介绍</a></li></ul></li><li><span>教程</span><ul><li data-id="/guides/start/"><a href="/san-test-utils/guides/start/" onclick="return false;">起步</a></li><li data-id="/guides/common-tips/"><a href="/san-test-utils/guides/common-tips/" onclick="return false;">常用技巧</a></li><li data-id="/guides/event/"><a href="/san-test-utils/guides/event/" onclick="return false;">测试键盘、鼠标等其它 DOM 事件</a></li><li data-id="/guides/test-runner/"><a href="/san-test-utils/guides/test-runner/" onclick="return false;">选择一个测试运行器</a></li><li data-id="/guides/jest-demo/"><a href="/san-test-utils/guides/jest-demo/" onclick="return false;">用 Jest 测试组件</a></li><li data-id="/guides/mocha-demo/"><a href="/san-test-utils/guides/mocha-demo/" onclick="return false;">用 Mocha 和 webpack 测试组件</a></li><li data-id="/guides/karma-demo/"><a href="/san-test-utils/guides/karma-demo/" onclick="return false;">用 Karma 测试组件</a></li><li data-id="/guides/async/"><a href="/san-test-utils/guides/async/" onclick="return false;">测试异步行为</a></li></ul></li><li><span>API</span><ul><li data-id="/api/attach/"><a href="/san-test-utils/api/attach/" onclick="return false;">attach</a></li><li data-id="/api/shallowAttach/"><a href="/san-test-utils/api/shallowAttach/" onclick="return false;">shallowAttach</a></li><li data-id="/api/render/"><a href="/san-test-utils/api/render/" onclick="return false;">render</a></li><li data-id="/api/renderToString/"><a href="/san-test-utils/api/renderToString/" onclick="return false;">renderToString</a></li><li data-id="/api/selector/"><a href="/san-test-utils/api/selector/" onclick="return false;">选择器</a></li><li data-id="/api/createWrapper/"><a href="/san-test-utils/api/createWrapper/" onclick="return false;">createWrapper</a></li><li data-id="/api/config/"><a href="/san-test-utils/api/config/" onclick="return false;">配置</a></li></ul></li><li><span>Wrapper</span><ul><li data-id="/wrapper/index/"><a href="/san-test-utils/wrapper/index/" onclick="return false;">属性</a></li><li data-id="/wrapper/attributes/"><a href="/san-test-utils/wrapper/attributes/" onclick="return false;">attributes</a></li><li data-id="/wrapper/classes/"><a href="/san-test-utils/wrapper/classes/" onclick="return false;">classes</a></li><li data-id="/wrapper/contains/"><a href="/san-test-utils/wrapper/contains/" onclick="return false;">contains</a></li><li data-id="/wrapper/fired/"><a href="/san-test-utils/wrapper/fired/" onclick="return false;">fired</a></li><li data-id="/wrapper/firedByOrder/"><a href="/san-test-utils/wrapper/firedByOrder/" onclick="return false;">firedByOrder</a></li><li data-id="/wrapper/data/"><a href="/san-test-utils/wrapper/data/" onclick="return false;">data</a></li><li data-id="/wrapper/detach/"><a href="/san-test-utils/wrapper/detach/" onclick="return false;">detach</a></li><li data-id="/wrapper/dispatched/"><a href="/san-test-utils/wrapper/dispatched/" onclick="return false;">dispatched</a></li><li data-id="/wrapper/dispatchedByOrder/"><a href="/san-test-utils/wrapper/dispatchedByOrder/" onclick="return false;">dispatchedByOrder</a></li><li data-id="/wrapper/exists/"><a href="/san-test-utils/wrapper/exists/" onclick="return false;">exists</a></li><li data-id="/wrapper/find/"><a href="/san-test-utils/wrapper/find/" onclick="return false;">find</a></li><li data-id="/wrapper/findAll/"><a href="/san-test-utils/wrapper/findAll/" onclick="return false;">findAll</a></li><li data-id="/wrapper/html/"><a href="/san-test-utils/wrapper/html/" onclick="return false;">html</a></li><li data-id="/wrapper/is/"><a href="/san-test-utils/wrapper/is/" onclick="return false;">is</a></li><li data-id="/wrapper/isEmpty/"><a href="/san-test-utils/wrapper/isEmpty/" onclick="return false;">isEmpty</a></li><li data-id="/wrapper/isVisible/"><a href="/san-test-utils/wrapper/isVisible/" onclick="return false;">isVisible</a></li><li data-id="/wrapper/isSanInstance/"><a href="/san-test-utils/wrapper/isSanInstance/" onclick="return false;">isSanInstance</a></li><li data-id="/wrapper/setChecked/"><a href="/san-test-utils/wrapper/setChecked/" onclick="return false;">setChecked</a></li><li data-id="/wrapper/setData/"><a href="/san-test-utils/wrapper/setData/" onclick="return false;">setData</a></li><li data-id="/wrapper/setMethods/"><a href="/san-test-utils/wrapper/setMethods/" onclick="return false;">setMethods</a></li><li data-id="/wrapper/setSelected/"><a href="/san-test-utils/wrapper/setSelected/" onclick="return false;">setSelected</a></li><li data-id="/wrapper/setValue/"><a href="/san-test-utils/wrapper/setValue/" onclick="return false;">setValue</a></li><li data-id="/wrapper/text/"><a href="/san-test-utils/wrapper/text/" onclick="return false;">text</a></li><li data-id="/wrapper/trigger/"><a href="/san-test-utils/wrapper/trigger/" onclick="return false;">trigger</a></li></ul></li><li><span>WrapperArray</span><ul><li data-id="/wrapperArray/index/"><a href="/san-test-utils/wrapperArray/index/" onclick="return false;">属性</a></li><li data-id="/wrapperArray/at/"><a href="/san-test-utils/wrapperArray/at/" onclick="return false;">at</a></li><li data-id="/wrapperArray/detach/"><a href="/san-test-utils/wrapperArray/detach/" onclick="return false;">detach</a></li><li data-id="/wrapperArray/filter/"><a href="/san-test-utils/wrapperArray/filter/" onclick="return false;">filter</a></li><li data-id="/wrapperArray/is/"><a href="/san-test-utils/wrapperArray/is/" onclick="return false;">is</a></li><li data-id="/wrapperArray/isEmpty/"><a href="/san-test-utils/wrapperArray/isEmpty/" onclick="return false;">isEmpty</a></li><li data-id="/wrapperArray/isSanInstance/"><a href="/san-test-utils/wrapperArray/isSanInstance/" onclick="return false;">isSanInstance</a></li><li data-id="/wrapperArray/setChecked/"><a href="/san-test-utils/wrapperArray/setChecked/" onclick="return false;">setChecked</a></li><li data-id="/wrapperArray/setData/"><a href="/san-test-utils/wrapperArray/setData/" onclick="return false;">setData</a></li><li data-id="/wrapperArray/setMethods/"><a href="/san-test-utils/wrapperArray/setMethods/" onclick="return false;">setMethods</a></li><li data-id="/wrapperArray/setValue/"><a href="/san-test-utils/wrapperArray/setValue/" onclick="return false;">setValue</a></li><li data-id="/wrapperArray/trigger/"><a href="/san-test-utils/wrapperArray/trigger/" onclick="return false;">trigger</a></li></ul></li><li><span>挂载选项</span><ul><li data-id="/attachOptions/slots/"><a href="/san-test-utils/attachOptions/slots/" onclick="return false;">slots</a></li><li data-id="/attachOptions/stubs/"><a href="/san-test-utils/attachOptions/stubs/" onclick="return false;">stubs</a></li><li data-id="/attachOptions/data/"><a href="/san-test-utils/attachOptions/data/" onclick="return false;">data</a></li><li data-id="/attachOptions/attachToDocument/"><a href="/san-test-utils/attachOptions/attachToDocument/" onclick="return false;">attachToDocument</a></li><li data-id="/attachOptions/parentComponent/"><a href="/san-test-utils/attachOptions/parentComponent/" onclick="return false;">parentComponent</a></li><li data-id="/attachOptions/methods/"><a href="/san-test-utils/attachOptions/methods/" onclick="return false;">methods</a></li></ul></li></ul></aside><article id="content"><div id="router-view" class="router-view"><div class="content markdown-content"><div class="markdown"><h1 id="%E8%B5%B7%E6%AD%A5">起步</h1><blockquote><p>我们在 <a href="https://github.com/ecomfe/san-test-utils/tree/master/docs/demo/start" target="_blank">github</a> 上放有一个关于起步的示例工程。</p></blockquote><h1 id="%E5%AE%89%E8%A3%85">安装</h1><p>快速尝鲜 San Test Utils 的办法就是克隆我们的 demo 仓库再加上基本的设置和依赖安装。</p><pre class="language-js"><code class="language-js">$ git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>ecomfe<span class="token operator">/</span>san<span class="token operator">-</span>test<span class="token operator">-</span>utils<span class="token punctuation">.</span>git
$ cd docs<span class="token operator">/</span>demo<span class="token operator">/</span>start
$ npm install</code></pre><p>你会发现该工程包含了一个简单的组件 <code>counter.js</code>：</p><pre class="language-js"><code class="language-js"><span class="token comment">// counter.js</span>

<span class="token keyword">import</span> san <span class="token keyword">from</span> <span class="token string">&#39;san&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> san<span class="token punctuation">.</span><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;
        &lt;span class=&quot;count&quot;&gt;{{count}}&lt;/span&gt;
        &lt;button on-click=&quot;increment&quot;&gt;Increment&lt;/button&gt;
    &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>

    <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">,</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="%E6%8C%82%E8%BD%BD%E7%BB%84%E4%BB%B6">挂载组件</h3><p>San Test Utils 通过将它们隔离挂载，然后模拟必要的输入 (data、用户事件) 和对输出 (渲染结果、触发的自定义事件) 的断言来测试 San 组件。</p><p>被挂载的组件会返回到一个 <a href="/san-test-utils/wrapper/index/">包裹器</a> 内，而包裹器会暴露很多封装、遍历和查询其内部的 San 组件实例的便捷的方法。</p><p>你可以通过 <code>attach</code> 方法来创建包裹器。让我们创建一个名叫 <code>test.js</code> 的文件：</p><pre class="language-js"><code class="language-js"><span class="token comment">// test.js</span>

<span class="token comment">// 从测试实用工具集中导入 `attach()` 方法</span>
<span class="token comment">// 同时导入你要测试的组件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>attach<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;san-test-utils&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">&#39;./counter&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 现在挂载组件，你便得到了这个包裹器</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">attach</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 你可以通过 `wrapper.vm` 访问实际的 San 实例</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">;</span>

<span class="token comment">// 我们对 San Test Utils 的探索也由此开始</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="%E6%B5%8B%E8%AF%95%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%87%BA%E6%9D%A5%E7%9A%84-html">测试组件渲染出来的 HTML</h3><p>现在我们已经有了这个包裹器，我们能做的第一件事就是确认该组件渲染出来的 HTML 符合预期。</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>attach<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;san-test-utils&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">&#39;./counter&#39;</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Counter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 现在挂载组件，你便得到了这个包裹器</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">attach</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;renders the correct markup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;span class=&quot;count&quot;&gt;0&lt;/span&gt;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 也便于检查已存在的元素</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;has a button&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>现在运行 <code>npm test</code> 进行测试。你应该看得到测试通过。</p><h3 id="%E6%A8%A1%E6%8B%9F%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92">模拟用户交互</h3><p>当用户点击按钮的时候，我们的计数器应该递增。为了模拟这一行为，我们首先需要通过 <code>wrapper.find()</code> 定位该按钮，此方法返回一个该按钮元素的包裹器。然后我们能够通过对该按钮包裹器调用 <code>.trigger()</code> 来模拟点击。</p><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;button click should increment the count&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="%E5%85%B3%E4%BA%8E%E5%BC%82%E6%AD%A5">关于异步</h3><p>San 会异步的将未生效的 DOM 更新批量应用，以避免因数据反复突变而导致的无谓的重渲染。这也是为什么在实践过程中我们经常在触发状态改变后用 San.nextTick 来等待 San 把实际的 DOM 更新做完的原因。</p><p>在上面的例子中，当按钮被点击时，count会被同步+1，但对应的 DOM 实际并没有更新，如果想测试对应 DOM 是否正常渲染，可以使用如下写法：</p><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;button click should increment the count&#39;</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    san<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">&#39;&lt;span class=&quot;count&quot;&gt;1&lt;/span&gt;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%98%AF%E4%BB%80%E4%B9%88">下一步是什么</h3><ul><li><a href="/san-test-utils/guides/test-runner/">选择一个测试运行器</a> 以把 San Test Utils 集成到你的工程里。</li><li>移步 <a href="/san-test-utils/guides/common-tips/">撰写测试的常见技巧</a> 以学习更多。</li></ul></div></div></div><aside class="toc"><ul class="tree"></ul></aside></article></div></div><script src="/san-test-utils/static/js/chunk-vendors.js"></script><script src="/san-test-utils/static/js/client-entry.js"></script></body></html>